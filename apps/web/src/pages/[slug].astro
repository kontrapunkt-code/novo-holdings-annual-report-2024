---
import PageModules from "@/components/astro/PageModules.astro";
import PageLayout from "@/layouts/PageLayout.astro";
import { pagesQuery, runQuery } from "@/scripts/queries";
import type { GetStaticPathsResult, InferGetStaticPropsType } from "astro";

export const getStaticPaths = async () => {
	const pages = await runQuery(pagesQuery, {
		parameters: {},
	});

	const staticPaths = pages.map((page) => ({
		params: {
			slug: page.slug?.current ?? "404",
		},
		props: {
			page,
		},
	}));

	return staticPaths satisfies GetStaticPathsResult;
};

export type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { page } = Astro.props;
---

<PageLayout title={page.title ?? undefined}>
	<PageModules modules={page.modules} />
</PageLayout>
