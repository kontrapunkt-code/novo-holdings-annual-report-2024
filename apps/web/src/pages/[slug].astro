---
import { PAGES_QUERY } from "@novo-holdings-annual-report-2024/studio/queries";
import type { PAGES_QUERYResult } from "@novo-holdings-annual-report-2024/studio/types";
import type { GetStaticPathsResult } from "astro";
import { sanityClient } from "sanity:client";
import HeroModuleComponent from "../components/modules/HeroModule.astro";
import ImageModuleComponent from "../components/modules/ImageModule.astro";
import TextModuleComponent from "../components/modules/TextModule.astro";
import PageLayout from "../layouts/PageLayout.astro";

export const getStaticPaths = async () => {
	const pages = await sanityClient.fetch<PAGES_QUERYResult>(PAGES_QUERY);

	const staticPaths = pages.map((page) => ({
		params: { slug: page.slug ?? "404" },
		props: { page },
	})) satisfies GetStaticPathsResult;

	return staticPaths;
};

const { page } = Astro.props;
---

<PageLayout title={page.title ?? undefined}>
	{
		page.modules?.map((module) => {
			switch (module._type) {
				case "heroModule":
					return <HeroModuleComponent {...module} />;
				case "textModule":
					return <TextModuleComponent {...module} />;
				case "imageModule":
					return <ImageModuleComponent {...module} />;
				default:
					return null;
			}
		})
	}
</PageLayout>
